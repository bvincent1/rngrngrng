name: Format Markdown

on:
  push:
    branches:
      - 'main'

jobs:
  format:
    # Use a recent Ubuntu runner
    runs-on: ubuntu-latest
    
    # Optional: Prevents action from running on commits made by the bot itself
    if: github.actor != 'github-actions[bot]'

    steps:
      - name: â¬‡ï¸ Checkout Repository
        uses: actions/checkout@v4

      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: ğŸ“¦ Install Dependencies
        run: yarn install

      - name: ğŸ’… Format Markdown Files
        run: make format

      - name: Update word counts
        run: make counts

      - name: â¬†ï¸ Commit Formatted Files
        # Action to automatically commit and push any changes made by the previous step
        uses: stefanzweifel/git-auto-commit-action@v7
        with:
          # A clear commit message for the auto-formatting
          commit_message: 'Auto-format Markdown files & update word counts'
          # Files to include in the commit (defaults to all changed files)
          file_pattern: '**/*.md'
          # Use a GitHub Token with write access
          token: ${{ secrets.GITHUB_TOKEN }}
          # The branch to commit back to is the current branch (implicit)
